<!doctype html><html><head><meta charset='utf-8'><title>Player</title><link rel='stylesheet' href='/style.css'><script src='https://cdn.socket.io/4.8.1/socket.io.min.js'></script></head><body><h1>Player</h1><div class='stage' id='stage'><img id='img'><div id='overlay' class='overlay-dark'></div><div id='clicks'></div><canvas id='mask'></canvas></div><div id='question'></div><script>const s=io();let myId,myColor,curRound,myClick;const img=document.getElementById('img'),overlay=document.getElementById('overlay'),clicks=document.getElementById('clicks'),mask=document.getElementById('mask'),ctx=mask.getContext('2d'),stage=document.getElementById('stage'),q=document.getElementById('question');function resize(){mask.width=stage.clientWidth;mask.height=stage.clientHeight;}addEventListener('resize',resize);function drawMine(){clicks.innerHTML='';if(!myClick)return;const d=document.createElement('div');d.className='dot';d.style.left=(myClick.x*100)+'%';d.style.top=(myClick.y*100)+'%';d.style.background=myColor;clicks.appendChild(d);}stage.onclick=e=>{if(!curRound)return;if(Date.now()<curRound.willDarkAt)return;if(myClick)return;const r=stage.getBoundingClientRect();myClick={x:(e.clientX-r.left)/r.width,y:(e.clientY-r.top)/r.height};drawMine();s.emit('player:click',myClick);};function applyDark(a){overlay.classList.toggle('active',!!a);}function clearMask(){ctx.clearRect(0,0,mask.width,mask.height);}function reveal(clicks,rPct){clearMask();ctx.fillStyle='rgba(0,0,0,0.95)';ctx.fillRect(0,0,mask.width,mask.height);ctx.globalCompositeOperation='destination-out';const r=rPct/100*Math.min(mask.width,mask.height);clicks.forEach(c=>{ctx.beginPath();ctx.arc(c.x*mask.width,c.y*mask.height,r,0,Math.PI*2);ctx.fill();});ctx.globalCompositeOperation='source-over';}s.on('hello',d=>{myId=d.id;myColor=d.color;if(d.round)onStart(d.round);});function onStart(r){curRound=r;myClick=null;drawMine();img.src=r.imageUrl;applyDark(false);clearMask();resize();setTimeout(()=>{applyDark(true);q.textContent=r.question||'';},Math.max(0,r.willDarkAt-Date.now()));}s.on('round:start',onStart);s.on('round:reveal',({clicks:cs,clickRadiusPct})=>{clicks.innerHTML='';cs.forEach(c=>{const d=document.createElement('div');d.className='dot';d.style.left=(c.x*100)+'%';d.style.top=(c.y*100)+'%';d.style.background=c.color;clicks.appendChild(d);const r=document.createElement('div');r.className='ring';r.style.left=(c.x*100)+'%';r.style.top=(c.y*100)+'%';r.style.width=(clickRadiusPct*2)+'%';r.style.height=(clickRadiusPct*2)+'%';r.style.borderColor=c.color;clicks.appendChild(r);});resize();reveal(cs,clickRadiusPct);});s.on('round:judged',({winners})=>{if(winners.includes(myId)){q.textContent+=(q.textContent?' ':'')+'+5 Punkte!';}});</script></body></html>